package com.agronomia;

import javax.persistence.*;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Controller;
import org.springframework.stereotype.Repository;
import org.springframework.stereotype.Service;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.*;

import java.util.List;

@SpringBootApplication
public class AgronomiaApp {
    public static void main(String[] args) {
        SpringApplication.run(AgronomiaApp.class, args);
    }
}

// Entidade Cultivo
@Entity
class Cultivo {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    private String nome;
    private String tipo;
    private String epocaPlantio;
    private int diasColheita;
    private String soloRecomendado;
    private String climaIdeal;
    private String descricao;

    // Getters e Setters
    public Long getId() { return id; }
    public void setId(Long id) { this.id = id; }
    public String getNome() { return nome; }
    public void setNome(String nome) { this.nome = nome; }
    public String getTipo() { return tipo; }
    public void setTipo(String tipo) { this.tipo = tipo; }
    public String getEpocaPlantio() { return epocaPlantio; }
    public void setEpocaPlantio(String epocaPlantio) { this.epocaPlantio = epocaPlantio; }
    public int getDiasColheita() { return diasColheita; }
    public void setDiasColheita(int diasColheita) { this.diasColheita = diasColheita; }
    public String getSoloRecomendado() { return soloRecomendado; }
    public void setSoloRecomendado(String soloRecomendado) { this.soloRecomendado = soloRecomendado; }
    public String getClimaIdeal() { return climaIdeal; }
    public void setClimaIdeal(String climaIdeal) { this.climaIdeal = climaIdeal; }
    public String getDescricao() { return descricao; }
    public void setDescricao(String descricao) { this.descricao = descricao; }
}

// Repositório
@Repository
interface CultivoRepository extends JpaRepository<Cultivo, Long> {
    List<Cultivo> findByNomeContainingIgnoreCase(String nome);
    List<Cultivo> findByTipo(String tipo);
    List<Cultivo> findByEpocaPlantio(String epoca);
}

// Serviço
@Service
class CultivoService {
    @Autowired
    private CultivoRepository repository;
    
    public List<Cultivo> listarTodos() { return repository.findAll(); }
    public Cultivo salvar(Cultivo cultivo) { return repository.save(cultivo); }
    public Cultivo obterPorId(Long id) { return repository.findById(id).orElse(null); }
    public List<Cultivo> buscarPorNome(String nome) { return repository.findByNomeContainingIgnoreCase(nome); }
    public void deletar(Long id) { repository.deleteById(id); }
}

// Controlador
@Controller
@RequestMapping("/cultivos")
class CultivoController {
    @Autowired
    private CultivoService service;

    @GetMapping
    public String listar(Model model) {
        model.addAttribute("cultivos", service.listarTodos());
        return "lista";
    }

    @GetMapping("/novo")
    public String novoForm(Model model) {
        model.addAttribute("cultivo", new Cultivo());
        return "form";
    }

    @PostMapping("/salvar")
    public String salvar(@ModelAttribute Cultivo cultivo) {
        service.salvar(cultivo);
        return "redirect:/cultivos";
    }

    @GetMapping("/buscar")
    public String buscar(@RequestParam String termo, Model model) {
        model.addAttribute("cultivos", service.buscarPorNome(termo));
        return "lista";
    }

    @GetMapping("/{id}")
    public String detalhes(@PathVariable Long id, Model model) {
        Cultivo cultivo = service.obterPorId(id);
        if (cultivo == null) {
            return "redirect:/cultivos";
        }
        model.addAttribute("cultivo", cultivo);
        return "detalhes";
    }

    @GetMapping("/{id}/editar")
    public String editarForm(@PathVariable Long id, Model model) {
        Cultivo cultivo = service.obterPorId(id);
        if (cultivo == null) {
            return "redirect:/cultivos";
        }
        model.addAttribute("cultivo", cultivo);
        return "form";
    }

    @GetMapping("/{id}/excluir")
    public String excluir(@PathVariable Long id) {
        service.deletar(id);
        return "redirect:/cultivos";
    }
}

// Configuração de propriedades (normalmente em application.properties)
/*
spring.datasource.url=jdbc:h2:mem:agronomia_db
spring.datasource.driverClassName=org.h2.Driver
spring.datasource.username=sa
spring.datasource.password=
spring.h2.console.enabled=true
spring.h2.console.path=/h2-console
spring.jpa.show-sql=true
spring.jpa.hibernate.ddl-auto=update
spring.thymeleaf.cache=false
*/
